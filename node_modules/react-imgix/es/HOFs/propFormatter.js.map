{"version":3,"file":"propFormatter.js","names":["React","PARAMS_EXP_MAP","formatSrc","src","domain","useHTTPS","indexOf","strippedDomain","replace","strippedSrc","prefix","formatProps","props","width","undefined","height","useHttps","collapseImgixParams","params","compactedParams","k","v","processPropsHOF","Component","formattedProps","formattedImgixParams","imgixParams"],"sources":["../../src/HOFs/propFormatter.js"],"sourcesContent":["import * as React from \"react\";\nimport { PARAMS_EXP_MAP } from \"./constants\";\n\n/**\n * Creates a 1-step, or complete, URL from `domain` and `src` Strings.\n *\n * - First, the function checks if src has a defined `domain`. If it does, it\n * checks to see if `src` has a scheme, and prepends \"http\" or \"https\" as needed\n * - Otherwise, formatSrc formats `domain` and `src` Strings.\n *   - First it strips the two strings of the  leading and `/` or trailing `/`\n *     slash characters.\n *   - Then, it joins the two strings on a `/` character. IE,\n *    `strippedDomain + \"/\" + strippedSrc`.\n *   - If `domain` String argument `null` or `undefined`, the function returns\n *    the original `src` String.\n *\n * @param {String} src - URL that is either 1-step or 2-step\n * @param {String} domain - Domain string, optional\n * @returns 1-step, or complete, URL String. Ex, _assets.ix.net/foo/bar.jpg_\n */\nexport function formatSrc(src, domain, useHTTPS = true) {\n  // ignore if already has protocol\n  if (src.indexOf(\"://\") !== -1) {\n    return src;\n  } else {\n    // prepend domain if defined\n    if (domain == null) {\n      return src;\n    }\n    const strippedDomain = domain ? domain.replace(/^\\/|\\/$/g, \"\") : \"\";\n    const strippedSrc = src.replace(/^\\/|\\/$/g, \"\");\n    const prefix = useHTTPS ? \"https://\" : \"http://\";\n    return prefix + strippedDomain + \"/\" + strippedSrc;\n  }\n}\n\n/**\n * A function that formats the following values in the props Object:\n *\n * - `width`: if undefined or negative gets set to `undefined`.\n * - `height`: if undefined or negative gets set to `undefined`.\n * - `src`: concatenated to `domain` if `src` defined and has no domain.\n *\n * @param {Object} props\n * @returns A formatted `props` Object.\n */\nexport const formatProps = (props) => {\n  const width = !props.width || props.width <= 1 ? undefined : props.width;\n  const height = !props.height || props.height <= 1 ? undefined : props.height;\n  const src = props.src\n    ? formatSrc(props.src, props.domain, props.useHttps)\n    : undefined;\n\n  return Object.assign({}, props, { width, height, src });\n};\n\n/**\n * Function that shortens params keys according to the imgix spec.\n * @param {Object} params - imgixParams object\n * @returns imgixParams object with shortened keys\n * @see https://www.imgix.com/docs/reference\n */\nexport const collapseImgixParams = (params) => {\n  if (params == null) {\n    return params;\n  }\n  const compactedParams = {};\n  for (const [k, v] of Object.entries(params)) {\n    if (PARAMS_EXP_MAP[k]) {\n      compactedParams[PARAMS_EXP_MAP[k]] = v;\n    } else {\n      compactedParams[k] = v;\n    }\n  }\n  return compactedParams;\n};\n\n/**\n * `processPropsHOF` takes a Component's props and formats them to adhere to the\n * ImgixClient's specifications.\n *\n * @param {React.Element<typeof Component>} Component - A react component with\n * defined `props`.\n * @returns A React Component who's `props` have been formatted and\n * `imgixParams` have been collapsed.\n */\nexport const processPropsHOF = (Component) => (props) => {\n  const formattedProps = formatProps(props);\n  const formattedImgixParams = collapseImgixParams(formattedProps.imgixParams);\n\n  return <Component {...formattedProps} imgixParams={formattedImgixParams} />;\n};\n"],"mappings":";;;;;;;;;;;;;AAAA,OAAO,KAAKA,KAAK,MAAM,OAAO;AAC9B,SAASC,cAAc,QAAQ,aAAa;;AAE5C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,SAASC,SAAS,CAACC,GAAG,EAAEC,MAAM,EAAmB;EAAA,IAAjBC,QAAQ,uEAAG,IAAI;EACpD;EACA,IAAIF,GAAG,CAACG,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,EAAE;IAC7B,OAAOH,GAAG;EACZ,CAAC,MAAM;IACL;IACA,IAAIC,MAAM,IAAI,IAAI,EAAE;MAClB,OAAOD,GAAG;IACZ;IACA,IAAMI,cAAc,GAAGH,MAAM,GAAGA,MAAM,CAACI,OAAO,CAAC,UAAU,EAAE,EAAE,CAAC,GAAG,EAAE;IACnE,IAAMC,WAAW,GAAGN,GAAG,CAACK,OAAO,CAAC,UAAU,EAAE,EAAE,CAAC;IAC/C,IAAME,MAAM,GAAGL,QAAQ,GAAG,UAAU,GAAG,SAAS;IAChD,OAAOK,MAAM,GAAGH,cAAc,GAAG,GAAG,GAAGE,WAAW;EACpD;AACF;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,IAAME,WAAW,GAAG,SAAdA,WAAW,CAAIC,KAAK,EAAK;EACpC,IAAMC,KAAK,GAAG,CAACD,KAAK,CAACC,KAAK,IAAID,KAAK,CAACC,KAAK,IAAI,CAAC,GAAGC,SAAS,GAAGF,KAAK,CAACC,KAAK;EACxE,IAAME,MAAM,GAAG,CAACH,KAAK,CAACG,MAAM,IAAIH,KAAK,CAACG,MAAM,IAAI,CAAC,GAAGD,SAAS,GAAGF,KAAK,CAACG,MAAM;EAC5E,IAAMZ,GAAG,GAAGS,KAAK,CAACT,GAAG,GACjBD,SAAS,CAACU,KAAK,CAACT,GAAG,EAAES,KAAK,CAACR,MAAM,EAAEQ,KAAK,CAACI,QAAQ,CAAC,GAClDF,SAAS;EAEb,OAAO,SAAc,CAAC,CAAC,EAAEF,KAAK,EAAE;IAAEC,KAAK,EAALA,KAAK;IAAEE,MAAM,EAANA,MAAM;IAAEZ,GAAG,EAAHA;EAAI,CAAC,CAAC;AACzD,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,IAAMc,mBAAmB,GAAG,SAAtBA,mBAAmB,CAAIC,MAAM,EAAK;EAC7C,IAAIA,MAAM,IAAI,IAAI,EAAE;IAClB,OAAOA,MAAM;EACf;EACA,IAAMC,eAAe,GAAG,CAAC,CAAC;EAC1B,mCAAqB,eAAeD,MAAM,CAAC,qCAAE;IAAxC;MAAOE,CAAC;MAAEC,CAAC;IACd,IAAIpB,cAAc,CAACmB,CAAC,CAAC,EAAE;MACrBD,eAAe,CAAClB,cAAc,CAACmB,CAAC,CAAC,CAAC,GAAGC,CAAC;IACxC,CAAC,MAAM;MACLF,eAAe,CAACC,CAAC,CAAC,GAAGC,CAAC;IACxB;EACF;EACA,OAAOF,eAAe;AACxB,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,IAAMG,eAAe,GAAG,SAAlBA,eAAe,CAAIC,SAAS;EAAA,OAAK,UAACX,KAAK,EAAK;IACvD,IAAMY,cAAc,GAAGb,WAAW,CAACC,KAAK,CAAC;IACzC,IAAMa,oBAAoB,GAAGR,mBAAmB,CAACO,cAAc,CAACE,WAAW,CAAC;IAE5E,oBAAO,oBAAC,SAAS,eAAKF,cAAc;MAAE,WAAW,EAAEC;IAAqB,GAAG;EAC7E,CAAC;AAAA"}