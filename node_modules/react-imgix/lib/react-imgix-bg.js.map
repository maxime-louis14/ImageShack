{"version":3,"file":"react-imgix-bg.js","names":["findNearestWidth","actualWidth","findClosest","targetWidths","toFixed","dp","value","__shouldComponentUpdate","props","nextProps","contentRect","bounds","prevWidth","width","prevHeight","height","nextContentRect","nextBounds","nextWidth","nextHeight","customizer","oldProp","newProp","key","shallowEqual","a","b","Array","isArray","undefined","propsEqual","BackgroundImpl","measureRef","imgixParams","onLoad","disableLibraryParam","disablePathEncoding","src","children","className","forcedWidth","w","forcedHeight","h","hasDOMDimensions","htmlAttributes","dpr","global","devicePixelRatio","ref","onRef","el","bothWidthAndHeightPassed","ar","neitherWidthNorHeightPassed","Math","ceil","isReady","commonProps","renderedSrc","extractQueryParams","rawSrc","params","longImgixParams","fit","ixlib","PACKAGE_VERSION","srcOptions","constructUrl","style","backgroundImage","backgroundSize","React","Component","Background","withContentRect"],"sources":["../src/react-imgix-bg.jsx"],"sourcesContent":["import React from \"react\";\nimport { withContentRect } from \"react-measure\";\nimport { shallowEqual } from \"./common\";\nimport { PACKAGE_VERSION } from \"./constants\";\nimport constructUrl from \"./constructUrl\";\nimport extractQueryParams from \"./extractQueryParams\";\nimport findClosest from \"./findClosest\";\nimport targetWidths from \"./targetWidths\";\n\nconst findNearestWidth = (actualWidth) =>\n  findClosest(actualWidth, targetWidths);\n\nconst toFixed = (dp, value) => +value.toFixed(dp);\n\nexport const __shouldComponentUpdate = (props, nextProps) => {\n  const contentRect = props.contentRect;\n  const bounds = contentRect.bounds;\n  const { width: prevWidth, height: prevHeight } = bounds;\n\n  const nextContentRect = nextProps.contentRect;\n  const nextBounds = nextContentRect.bounds;\n  const { width: nextWidth, height: nextHeight } = nextBounds;\n\n  // If neither of the previous nor next dimensions are present,\n  // re-render.\n  if (!nextWidth || !nextHeight || !prevWidth || !prevHeight) {\n    return true;\n  }\n\n  // The component has been rendered at least twice by this point\n  // and both the previous and next dimensions should be defined.\n  // Only update if the nextWidth is greater than the prevWidth.\n  if (prevWidth && nextWidth && nextWidth > prevWidth) {\n    return true;\n  }\n\n  // Similarly, only update if the next height is greater than\n  // the previous height.\n  if (prevHeight && nextHeight && nextHeight > prevHeight) {\n    return true;\n  }\n\n  const customizer = (oldProp, newProp, key) => {\n    // these keys are ignored from prop checking process\n    if (key === \"contentRect\" || key === \"measure\" || key === \"measureRef\") {\n      return true;\n    }\n\n    if (key === \"children\") {\n      return oldProp == newProp;\n    }\n\n    if (key === \"imgixParams\") {\n      return shallowEqual(oldProp, newProp, (a, b) => {\n        if (Array.isArray(a)) {\n          return shallowEqual(a, b);\n        }\n        return undefined;\n      });\n    }\n\n    if (key === \"htmlAttributes\") {\n      return shallowEqual(oldProp, newProp);\n    }\n\n    return undefined; // handled by shallowEqual\n  };\n\n  // If we made it here, we need to check if the \"top-level\"\n  // props have changed (e.g. disableLibraryParam).\n  const propsEqual = shallowEqual(props, nextProps, customizer);\n\n  return !propsEqual;\n};\n\nclass BackgroundImpl extends React.Component {\n  constructor(props) {\n    super(props);\n  }\n\n  shouldComponentUpdate(nextProps) {\n    return __shouldComponentUpdate(this.props, nextProps);\n  }\n\n  render() {\n    const {\n      measureRef,\n      contentRect,\n      imgixParams = {},\n      onLoad,\n      disableLibraryParam,\n      disablePathEncoding,\n      src,\n      children,\n      className = \"\",\n    } = this.props;\n    const { w: forcedWidth, h: forcedHeight } = imgixParams;\n    const hasDOMDimensions =\n      contentRect.bounds.width != null && contentRect.bounds.height != null;\n    const htmlAttributes = this.props.htmlAttributes || {};\n    const dpr = toFixed(2, imgixParams.dpr || global.devicePixelRatio || 1);\n    const ref = htmlAttributes.ref;\n    const onRef = (el) => {\n      measureRef(el);\n      if (typeof ref === \"function\") {\n        ref(el);\n      }\n    };\n\n    const { width, height } = (() => {\n      const bothWidthAndHeightPassed =\n        forcedWidth != null && forcedHeight != null;\n\n      if (bothWidthAndHeightPassed) {\n        return { width: forcedWidth, height: forcedHeight };\n      }\n\n      if (!hasDOMDimensions) {\n        return { width: undefined, height: undefined };\n      }\n      const ar = contentRect.bounds.width / contentRect.bounds.height;\n\n      const neitherWidthNorHeightPassed =\n        forcedWidth == null && forcedHeight == null;\n      if (neitherWidthNorHeightPassed) {\n        const width = findNearestWidth(contentRect.bounds.width);\n        const height = Math.ceil(width / ar);\n        return { width, height };\n      }\n      if (forcedWidth != null) {\n        const height = Math.ceil(forcedWidth / ar);\n        return { width: forcedWidth, height };\n      } else if (forcedHeight != null) {\n        const width = Math.ceil(forcedHeight * ar);\n        return { width, height: forcedHeight };\n      }\n    })();\n    const isReady = width != null && height != null;\n\n    const commonProps = {\n      ...htmlAttributes,\n    };\n\n    if (!isReady) {\n      return (\n        <div\n          {...commonProps}\n          className={`react-imgix-bg-loading ${className}`}\n          ref={onRef}\n        >\n          {children}\n        </div>\n      );\n    }\n\n    const renderedSrc = (() => {\n      const [rawSrc, params] = extractQueryParams(src);\n      const longImgixParams = {\n        ...params,\n        fit: \"crop\",\n        ...imgixParams,\n        ...(disableLibraryParam ? {} : { ixlib: `react-${PACKAGE_VERSION}` }),\n        width,\n        height,\n        dpr,\n      };\n\n      const srcOptions = {\n        disablePathEncoding,\n      }\n\n      return constructUrl(rawSrc, longImgixParams, srcOptions);\n    })();\n\n    const style = {\n      ...htmlAttributes.style,\n      backgroundImage: `url(${renderedSrc})`,\n      backgroundSize:\n        (htmlAttributes.style || {}).backgroundSize !== undefined\n          ? htmlAttributes.style.backgroundSize\n          : \"cover\",\n    };\n\n    return (\n      <div {...commonProps} className={className} ref={onRef} style={style}>\n        {children}\n      </div>\n    );\n  }\n}\nconst Background = withContentRect(\"bounds\")(BackgroundImpl);\n\nexport { Background, BackgroundImpl as __BackgroundImpl };\n"],"mappings":"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"}