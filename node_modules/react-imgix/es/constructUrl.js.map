{"version":3,"file":"constructUrl.js","names":["PACKAGE_VERSION","ImgixClient","extractQueryParams","PARAM_EXPANSION","Object","freeze","brightness","contrast","exposure","gamma","highlights","hue","invert","saturation","shaddows","shadows","sharpness","vibrance","blend","border","padding","faces","download","DPI","format","quality","orientation","blurring","halftone","monotone","pixelate","height","width","DEFAULT_OPTIONS","auto","constructUrl","src","longImgixParams","srcOptions","params","compactParamKeys","extractClientAndPathComponents","client","pathComponents","buildURL","join","keys","keysLength","length","i","key","split","scheme","rest","domain","useHTTPS","includeLibraryParam","buildURLPublic","imgixParams","options","disableLibraryParam","rawSrc","ixlib"],"sources":["../src/constructUrl.js"],"sourcesContent":["/*\nCopyright Â© 2015 by Coursera\nLicensed under the Apache License 2.0, seen https://github.com/coursera/react-imgix/blob/master/LICENSE\n\nMinor syntax modifications have been made\n*/\n\nconst PACKAGE_VERSION = require(\"../package.json\").version;\nimport ImgixClient from \"@imgix/js-core\";\nimport extractQueryParams from \"./extractQueryParams\";\n\n// @see https://www.imgix.com/docs/reference\nvar PARAM_EXPANSION = Object.freeze({\n  // Adjustment\n  brightness: \"bri\",\n  contrast: \"con\",\n  exposure: \"exp\",\n  gamma: \"gam\",\n  highlights: \"high\",\n  hue: \"hue\",\n  invert: \"invert\",\n  saturation: \"sat\",\n  shaddows: \"shad\",\n  shadows: \"shad\",\n  sharpness: \"sharp\",\n  \"unsharp-mask\": \"usm\",\n  \"unsharp-radius\": \"usmrad\",\n  vibrance: \"vib\",\n\n  // Automatic\n  \"auto-features\": \"auto\",\n\n  // Background\n  \"background-color\": \"bg\",\n\n  // Blend\n  blend: \"blend\",\n  \"blend-mode\": \"bm\",\n  \"blend-align\": \"ba\",\n  \"blend-alpha\": \"balph\",\n  \"blend-padding\": \"bp\",\n  \"blend-width\": \"bw\",\n  \"blend-height\": \"bh\",\n  \"blend-fit\": \"bf\",\n  \"blend-crop\": \"bc\",\n  \"blend-size\": \"bs\",\n  \"blend-x\": \"bx\",\n  \"blend-y\": \"by\",\n\n  // Border & Padding\n  border: \"border\",\n  padding: \"pad\",\n\n  // Face Detection\n  \"face-index\": \"faceindex\",\n  \"face-padding\": \"facepad\",\n  faces: \"faces\",\n\n  // Format\n  \"chroma-subsampling\": \"chromasub\",\n  \"color-quantization\": \"colorquant\",\n  download: \"dl\",\n  DPI: \"dpi\",\n  format: \"fm\",\n  \"lossless-compression\": \"lossless\",\n  quality: \"q\",\n\n  // Mask\n  \"mask-image\": \"mask\",\n\n  // Mask\n  \"noise-blur\": \"nr\",\n  \"noise-sharpen\": \"nrs\",\n\n  // Palette n/a\n  // PDF n/a\n  // Pixel Density n/a\n\n  // Rotation\n  \"flip-direction\": \"flip\",\n  orientation: \"or\",\n  \"rotation-angle\": \"rot\",\n\n  // Size\n  \"crop-mode\": \"crop\",\n  \"fit-mode\": \"fit\",\n  \"image-height\": \"h\",\n  \"image-width\": \"w\",\n\n  // Stylize\n  blurring: \"blur\",\n  halftone: \"htn\",\n  monotone: \"mono\",\n  pixelate: \"px\",\n  \"sepia-tone\": \"sepia\",\n\n  // Trim TODO\n  // Watermark TODO\n\n  // Extra\n  height: \"h\",\n  width: \"w\",\n});\n\nvar DEFAULT_OPTIONS = Object.freeze({\n  auto: \"format\", // http://www.imgix.com/docs/reference/automatic#param-auto\n});\n\n/**\n * Construct a URL for an image with an Imgix proxy, expanding image options\n * per the [API reference docs](https://www.imgix.com/docs/reference).\n * @param  {String} src         src of raw image\n * @param  {Object} longImgixParams map of image API options, in long or short form per expansion rules\n * @return {String}             URL of image src transformed by Imgix\n */\nfunction constructUrl(src, longImgixParams, srcOptions) {\n  if (!src) {\n    return \"\";\n  }\n  const params = compactParamKeys(longImgixParams);\n  const { client, pathComponents } = extractClientAndPathComponents(src);\n  return client.buildURL(pathComponents.join(\"/\"), params, srcOptions);\n}\n\nfunction compactParamKeys(longImgixParams) {\n  const keys = Object.keys(longImgixParams);\n  const keysLength = keys.length;\n  const params = {};\n  for (let i = 0; i < keysLength; i++) {\n    let key = keys[i];\n    if (PARAM_EXPANSION[key]) {\n      params[PARAM_EXPANSION[key]] = longImgixParams[key];\n    } else {\n      params[key] = longImgixParams[key];\n    }\n  }\n\n  return params;\n}\n\nfunction extractClientAndPathComponents(src) {\n  const [scheme, rest] = src.split(\"://\");\n  const [domain, ...pathComponents] = rest.split(\"/\");\n  let useHTTPS = scheme == \"https\";\n\n  const client = new ImgixClient({\n    domain: domain,\n    useHTTPS: useHTTPS,\n    includeLibraryParam: false,\n  });\n\n  return { client, pathComponents };\n}\n\nfunction buildURLPublic(src, imgixParams = {}, options = {}) {\n  const { disableLibraryParam } = options;\n\n  const [rawSrc, params] = extractQueryParams(src);\n\n  return constructUrl(\n    rawSrc,\n    Object.assign(\n      {},\n      params,\n      imgixParams,\n      disableLibraryParam ? {} : { ixlib: `react-${PACKAGE_VERSION}` }\n    )\n  );\n}\n\nexport default constructUrl;\n\nexport { buildURLPublic, compactParamKeys, extractClientAndPathComponents };\n"],"mappings":"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"}